<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>译-2023-年每个软件开发者都必须知道的关于-Unicode-的基本知识</title>
    <link rel="stylesheet" href="https://c1312.netlify.app/typo.css">
    <link rel="stylesheet" href="https://c1312.netlify.app/style.css">
</head>
<body>
<header>
  <h1>译-2023-年每个软件开发者都必须知道的关于-Unicode-的基本知识</h1>
</header>
<main class="typo"><article><div></div><p>二十年前，<a href=https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/>Joel Spolsky 写道</a><sup><a href=#user-content-fn-2003>1</a></sup>：<blockquote><p>没有所谓的纯文本。<p>不知道编码的字符串是没有意义的。你不能像鸵鸟一样再把头埋在沙子里，假装「纯」文本是 ASCII。</blockquote><p>20 年过去了，很多事情都变了。2003 年的时候，主要的问题是：文本用的是什么编码的？<p>到了 2023 年，这不再是一个问题：有 98% 的概率是 UTF-8。终于！我们可以再次把头埋在沙子里了！<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/ae0da93b.png width=1024 height=452></figure><p>现在的问题是：我们如何正确地使用 UTF-8？让我们来看看！<h2>什么是 Unicode？</h2><p>Unicode 是一种旨在统一过去和现在的所有人类语言，使其能够在计算机上使用的标准。<p>在实践中，Unicode 是一个将不同字符分配给唯一编号的表格。<p>例如：<ul><li>拉丁字母 <code>A</code> 被分配了数字 <code>65</code>。<li>阿拉伯字母 Seen <code>س</code> 是 <code>1587</code>。<li>片假名字母 Tu <code>ツ</code> 是 <code>12484</code><li>音乐记号中的高音谱号（G 谱号）<code>𝄞</code> 是 <code>119070</code>。<li><code class=emoji>💩</code> 是 <code>128169</code>。</ul><p>Unicode 将这些数字称为<em>码位</em>（code points）。<p>由于世界上的每个人都同意哪些数字对应哪些字符，并且我们都同意使用 Unicode，我们就可以阅读彼此的文本。<p><span>Unicode == 字符 ⟷ 码位。</span><h2>Unicode 有多大？</h2><p>目前，已被定义的最大码位是 0x10FFFF。这给了我们大约 110 万个码位的空间。<p>目前已定义了大约 17 万个码位，占 15%。另外 11% 用于私有使用。其余的大约 80 万个码位目前没有分配。它们可能在未来变成字符。<p>这里是大致的样子：<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/1a9143a3.png width=835 height=735></figure><p>大方框 == 平面 == 65,536 个字符。小方框 == 256 个字符。整个 ASCII 是左上角小红色方块的一半。<h2>什么是私用区？</h2><p>这些码位是为应用程序开发人员保留的，Unicode 自己永远不会定义它们。<p>例如，Unicode 中没有苹果 logo 的位置，因此 Apple 将其放在私用区块中的 <code>U+F8FF</code>。在任何其他字体中，它都将呈现为缺失的字形 <code>􀣺</code>，但在 macOS 附带的字体中，你就可以看到 <svg width="1em" height="17px">  <use xlink:href="#ai:ic:baseline-apple"></use>  </svg>。<p>私用区主要由图标字体使用：<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/73784955.png width=584 height=268><figcaption>是不是很漂亮？都是文本哦！</figcaption></figure><h2><code>U+1F4A9</code> 是什么意思？</h2><p>这是一种码位值写法的约定。前缀 <code>U+</code> 表示 Unicode，<code>1F4A9</code> 是十六进制中的码位数字。<p>噢，<code>U+1F4A9</code> 具体是 <code class=emoji>💩</code>。<h2>那 UTF-8 是什么？</h2><p>UTF-8 是一种编码。编码是我们在内存中存储码位的方式。<p>Unicode 最简单的编码是 UTF-32。它只是将码位存储为 32 位整数。因此，<code>U+1F4A9</code> 变为 <code>00 01 F4 A9</code>，占用四个字节。UTF-32 中的任何其他码位也将占用四个字节。由于最高定义的码位是 <code>U+10FFFF</code>，因此可以保证任何码位都适合。<p>UTF-16 和 UTF-8 不那么直接，但最终目标是相同的：将码位作为字节进行编码。<p>作为程序员，编码是你实际处理的内容。<h2>UTF-8 中有多少字节？</h2><p>UTF-8 是一种变长编码。码位可能被编码为一个到四个字节的序列。<p>这是它工作的方式：<table><thead><tr><th>码位<th>第 1 字节<th>第 2 字节<th>第 3 字节<th>第 4 字节<tbody><tr><td><p>U+<code>0000</code>..<code>007F</code><td><code>0xxxxxxx</code><tr><td><p>U+<code>0080</code>..<code>07FF</code><td><code>110xxxxx</code><td><code>10xxxxxx</code><tr><td><p>U+<code>0800</code>..<code>FFFF</code><td><code>1110xxxx</code><td><code>10xxxxxx</code><td><code>10xxxxxx</code><tr><td><p>U+<code>10000</code>..<code>10FFFF</code><td><code>11110xxx</code><td><code>10xxxxxx</code><td><code>10xxxxxx</code><td><code>10xxxxxx</code></table><p>将此与 Unicode 表结合起来，就可以看到英语使用 1 个字节进行编码，西里尔语、拉丁语、希伯来语和阿拉伯语需要 2 个字节，中文、日文、韩文、其他亚洲语言和 Emoji 需要 3 个或 4 个字节。<p>这里有几个要点：<p>第一，UTF-8 与 ASCII 兼容。码位 0..127，即 ASCII，使用一个字节进行编码，而且是完全相同的字节。<code>U+0041</code> (<code>A</code>，拉丁大写字母 A) 只是 <code>41</code>，一个字节。<p>任何纯 ASCII 文本也是有效的 UTF-8 文本，任何只使用码位 0..127 的 UTF-8 文本都可以直接读取为 ASCII。<p>第二，UTF-8 对于基本拉丁语来说可以节省空间。这是它比 UTF-16 的主要卖点之一。对于世界各地的文本来说可能不公平，但对于 HTML 标签或 JSON 键等技术字符串来说是有意义的。<p>平均而言，UTF-8 往往是一个相当不错的选择，即使对于使用非英语的计算机也是如此。而对于英语而言，没有比它更好的选择了。<p>第三，UTF-8 自带错误检测和错误恢复的功能。第一个字节的前缀总是与第 2-4 个字节不同，因而你总是可以判断你是否正在查看完整且有效的 UTF-8 字节序列，或者是否缺少某些内容（例如，你跳到了序列的中间）。然后你就可以通过向前或向后移动，直到找到正确序列的开头来纠正它。<p>这带来了一些重要的结论：<ul><li>你<strong>不能</strong>通过计数字节来确定字符串的长度。<li>你<strong>不能</strong>随机跳到字符串的中间并开始读取。<li>你<strong>不能</strong>通过在任意字节偏移处切割来获取子字符串。你可能会切掉字符的一部分。</ul><p>试图这样做的人最终会遇到这个坏小子：�<h2>� 是什么？</h2><p><code>U+FFFD</code>，<dfn>替换字符</dfn>，只是 Unicode 表中的另一个码位。当应用程序和库检测到 Unicode 错误时，它们可以使用它。<p>如果你切掉了码位的一半，那就没有什么其他办法，只能显示错误了。这就是使用 � 的时候。<pre class=astro-code><code>var bytes = &#34;Аналитика&#34;.getBytes(&#34;UTF-8&#34;);
var partial = Arrays.copyOfRange(bytes, 0, 11);
new String(partial, &#34;UTF-8&#34;); // =&gt; &#34;Анал�&#34;</code></pre><h2>使用 UTF-32 不会让一切变得更容易吗？</h2><p>不会。<p>UTF-32 对于操作码位很棒。确实，如果每个码位总是 4 个字节，那么 <code>strlen(s) == sizeof(s) / 4</code>，<code>substring(0, 3) == bytes[0, 12]</code>，等等。<p>问题是，你想操作的并非码位。码位不是书写的单位；一个码位不总是一个字符。你应该迭代的是叫做「<strong><dfn>扩展字位簇</dfn></strong>（extended grapheme cluster）」的东西，我们在这里简称字位。<p><dfn>字位</dfn>（grapheme，或译作字素）<sup><a href=#user-content-fn-1>2</a></sup>是在特定书写系统的上下文中最小的可区分的书写单位。<code>ö</code> 是一个字位。<code>é</code>、<code>각</code> 也是。基本上，字位是用户认为是单个字符的东西。<p>问题是，在 Unicode 中，一些字位使用多个码位进行编码！<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/e8a4c003.png width=600 height=340></figure><p>比如说，<code>é</code>（一个单独的字位）在 Unicode 中被编码为 <code>e</code>（U+0065 拉丁小写字母 E）+ <code>´</code>（U+0301 连接重音符）。两个码位！<p>它也可以是两个以上：<ul><li><code class=emoji>☹️</code> 是 <code>U+2639</code> + <code>U+FE0F</code><li><code class=emoji>👨‍🏭</code> 是 <code>U+1F468</code> + <code>U+200D</code> + <code>U+1F3ED</code><li><code class=emoji>🚵🏻‍♀️</code> 是 <code>U+1F6B5</code> + <code>U+1F3FB</code> + <code>U+200D</code> + <code>U+2640</code> + <code>U+FE0F</code><li><code>y̖̠͍̘͇͗̏̽̎͞</code> 是 <code>U+0079</code> + <code>U+0316</code> + <code>U+0320</code> + <code>U+034D</code> + <code>U+0318</code> + <code>U+0347</code> + <code>U+0357</code> + <code>U+030F</code> + <code>U+033D</code> + <code>U+030E</code> + <code>U+035E</code></ul><p>据我所知，没有限制。<p>记住，我们在这里谈论的是码位。即使在最宽的编码 UTF-32 中，<code class=emoji>👨‍🏭</code> 仍然需要三个 4 字节单元来编码。它仍然需要被视为一个单独的字符。<p>如果这个类比有帮助的话，我们可以认为 Unicode 本身（没有任何编码）是变长的。<p><span>一个扩展字位簇是一个或多个 Unicode 码位的序列，必须被视为一个单独的、不可分割的字符。</span><p>因此，我们会遇到所有变长编码的问题，但现在是在码位级别上：你不能只取序列的一部分——它总是应该作为一个整体被选择、复制、编辑或删除。<p>不尊重字位簇会导致像这样的错误：</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/b0f4d2b8.png><p>或者这样：<figure><figcaption>让我们先说清楚：这<em>不是</em>正确的行为</figcaption></figure><p>就扩展字位簇而言，用 UTF-32 代替 UTF-8 不会让你的生活变得更容易。而扩展字位簇才是你应该关心的。<p><span>码位 — 🥱. 字位 — 😍</span><h2>Unicode 之所以难，仅仅是因为表情符号吗？</h2><p>并不。没有消亡的、活跃使用的语言也使用扩展字位簇。例如：<ul><li><code>ö</code> (德语) 是一个单独的字符，但是多个码位（<code>U+006F U+0308</code>）。<li><code>ą́</code> (立陶宛语) 是 <code>U+00E1 U+0328</code>。<li><code>각</code> (韩语) 是 <code>U+1100 U+1161 U+11A8</code>。</ul><p>所以，不，这不仅仅是关于表情符号。<h2><code>&#34;🤦🏼‍♂️&#34;.length</code> 是什么？</h2><p>这个问题的灵感来自于<a href=https://hsivonen.fi/string-length/>这篇精彩的文章</a>。<p>不同的编程语言很乐意给你不同的答案。<p>Python 3:<pre class=astro-code><code>&gt;&gt;&gt; len(&#34;🤦🏼‍♂️&#34;)
5</code></pre><p>JavaScript / Java / C#:<pre class=astro-code><code>&gt;&gt; &#34;🤦🏼‍♂️&#34;.length
7</code></pre><p>Rust:<pre class=astro-code><code>println!(&#34;{}&#34;, &#34;🤦🏼‍♂️&#34;.len());
// =&gt; 17</code></pre><p>如你所料，不同的语言使用不同的内部字符串表示（UTF-32、UTF-16、UTF-8），并以它们存储字符的任何单位报告长度（int、short、byte）。<p><b>但是！</b>如果你问任何正常的人，一个不被计算机内部所拖累的人，他们会给你一个直接的答案：1。<code class=emoji>🤦🏼‍♂️</code> 字符串的长度是 1。<p>这就是扩展字位簇存在的意义：人们认为是单个字符。在这种情况下，<code class=emoji>🤦🏼‍♂️</code> 无疑是一个单独的字符。<p><code class=emoji>🤦🏼‍♂️</code> 包含 5 个码位（<code>U+1F926 U+1F3FB U+200D U+2642 U+FE0F</code>）的事实只是实现细节。它不应该被分开，它不应该被计算为多个字符，文本光标不应该被定位在它的内部，它不应该被部分选择，等等。<p>实际上，这是一个文本的原子单位。在内部，它可以被编码为任何东西，但对于面向用户的 API，它应该被视为一个整体。<p>唯一没弄错这件事的现代语言是 Swift：<pre class=astro-code><code>print(&#34;🤦🏼‍♂️&#34;.count)
// =&gt; 1</code></pre><p>基本上，有两层：<ol><li>内部，面向计算机的一层。如何复制字符串、通过网络发送字符串、存储在磁盘上等。这就是你需要 UTF-8 这样的编码的地方。Swift 在内部使用 UTF-8，但也可以是 UTF-16 或 UTF-32。重要的是，你只使用它来整体复制字符串，而不是分析它们的内容。<li>外部，面向人类的 API 一层。UI 中的字数统计。获取前 10 个字符以生成预览。在文本中搜索。像 <code>.count</code> 或 <code>.substring</code> 这样的方法。Swift 给你<em>一个视图</em>，假装字符串是一个字位簇序列。这个视图的行为就像任何人所期望的那样：它为 <code>&#34;🤦🏼‍♂️&#34;.count</code> 给出 1。</ol><p>我希望更多的语言尽快采用这种设计。<p>给读者的问题：你认为 <code>&#34;ẇ͓̞͒͟͡ǫ̠̠̉̏͠͡ͅr̬̺͚̍͛̔͒͢d̠͎̗̳͇͆̋̊͂͐&#34;.length</code> 应该是什么？<h2>如何检测扩展字位簇？</h2><p>不幸的是，大多数语言都选择了简单的方法，让你通过 1-2-4 字节块迭代字符串，而不是通过字位簇。<p>这没有意义，也不合语义，但由于它是缺省值，程序员不会再考虑，我们看到的结果是损坏的字符串：</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/62a97d48.png><p>「我知道，我会使用一个库来做 strlen()！」——从来没有人这样想。<p>但这正是你应该做的！使用一个合适的 Unicode 库！是的，对于像 <code>strlen</code> 或 <code>indexOf</code> 或 <code>substring</code> 这样的基本功能！<p>例如：<ol><li>C/C++/Java: 使用 <a href=https://github.com/unicode-org/icu>ICU</a>。它是一个来自 Unicode 自身的库，它对文本分割的所有规则进行编码。<li>C#: 使用 <code>TextElementEnumerator</code>，据我所知，它与 Unicode 保持最新。<li>Swift: 标准库就行。Swift 默认就做得很好。<li>UPD：Erlang/Elixir 似乎也做得很好。<li>对于其他语言，可能有一个 ICU 的库或绑定。<li>自己动手。Unicode <a href=https://www.unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries>发布</a>了机器可读的规则和表格，上面的所有库都是基于它们的。</ol><p>不过无论你选哪个，都要确保它是最近的 Unicode 版本（目前是 15.1），因为字位簇的定义会随着版本的变化而变化。例如，Java 的 <code>java.text.BreakIterator</code> 是不行的：它是基于一个非常旧的 Unicode 版本，而且没有更新。<p><span>用个库</span><p>我觉得，整个情况都令人遗憾。Unicode 应该是每种语言的标准库。这是互联网的通用语言！它甚至不是什么新鲜玩意<small>儿</small>：我们已经与 Unicode 生活了 20 年了。<h2>等下，规则一直变化？</h2><p>是的！很酷吧？<p>（我知道，这并不）<p>大概从 2014 年开始，Unicode 每年都会发布一次主要修订版。这就是你获得新的 emoji 的地方——Android 和 iOS 的更新通常包括最新的 Unicode 标准。<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/fb20e15c.png width=300 height=620></figure><p>对我们来说可悲的是定义字位簇的规则也在每年变化。今天被认为是两个或三个单独码位的序列，明天可能就成为字位簇！我们无从得知，没法准备！<p>更糟糕的是，你自己的应用程序的不同版本可能在不同的 Unicode 标准上运行，并给出不同的字符串长度！<p>但这就是我们所生活的现实——你实际上别无选择。如果你想站稳脚跟并提供良好的用户体验，就不能忽略 Unicode 或 Unicode 更新。所以，寄好安全带，拥抱更新。<p><span>每年更新</span><h2>为什么 <code>&#34;Å&#34; !== &#34;Å&#34; !== &#34;Å&#34;</code>？</h2><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/07008194.jfif><p>请将下面任何一行复制到你的 JavaScript 控制台：<pre class=astro-code><code>&#34;Å&#34; === &#34;Å&#34;;
&#34;Å&#34; === &#34;Å&#34;;
&#34;Å&#34; === &#34;Å&#34;;</code></pre><p>你得到了什么？False？确实是 <samp>false</samp>，并且这不是一个错误。<p>还记得我之前说过 <code>ö</code> 是两个码位，<code>U+006F U+0308</code> 吗？基本上，Unicode 提供了多种写法，比如 <code>ö</code> 或 <code>Å</code>。你可以：<ol><li>从普通拉丁字母 <code>A</code> + 一个连接字符组合出 <code>Å</code>，<li><em>或者</em>还有一个预组合的码位 <code>U+00C5</code> 帮你做了这件事。</ol><p>他们将会看起来一样（<code>Å</code> vs <code>Å</code>），它们应该用起来一样，并且它们实际上在方方面面都被视为完全一样。唯一的区别是字节表示。<p>这就是我们需要归一化的原因。有四种形式：<p><strong>NFD</strong> 尝试将所有东西都分解为最小的可能部分，并且如果有多个部分，则按照规范顺序对部分进行排序。<p><strong>NFC</strong>，另一方面，尝试将所有东西组合成存在的预组合形式。</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/3c01b40b.png><p>对于某些字符，它们在 Unicode 中也有多个版本。例如，有 <code>U+00C5 Latin Capital Letter A with Ring Above</code>，但也有 <code>U+212B Angstrom Sign</code>，它看起来是一样的。<p>这些也在归一化过程中被替换掉了：</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/43e6cb4c.png><p>NFD 和 NFC 被称为「规范归一化」。另外两种形式是「兼容归一化」：<p><strong>NFKD</strong> 尝试将所有东西分解开来，并用默认的替换视觉变体。<p><strong>NFKC</strong> 尝试将所有东西组合起来，同时用默认的替换视觉变体。</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/b7c74892.png><p><dfn>视觉变体</dfn>是表示相同字符的单独的 Unicode 码位，但是应该呈现不同。比如 <code>①</code> 或 <code>⁹</code> 或 <code>𝕏</code>。我们想要在像 <code>&#34;𝕏²&#34;</code> 这样的字符串中找到 <code>&#34;x&#34;</code> 和 <code>&#34;2&#34;</code>，不是吗？<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/566b4dba.png width=438 height=185><figcaption>所有这些字符都有它们自己的码位，但它们也都是 X</figcaption></figure><p>为什么连 <code>ﬁ</code> 这个连字都有它自己的码位？不知道。在一百万个字符中，很多事情都可能发生。<p><span>在比较字符串或搜索子字符串之前，归一化！</span><h2>Unicode 是基于<ruby>区域设置<rt>locale</ruby>的</h2><p>俄语名字 Nikolay 的写法如下：</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/2d52ff93.png><p>并且在 Unicode 中编码为 <code>U+041D 0438 043A 043E 043B 0430 0439</code>。<p>保加利亚语名字 Nikolay 的写法如下：</p><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/a7ce541c.png><p>并且在 Unicode 中编码为 <code>U+041D 0438 043A 043E 043B 0430 0439</code>。完全一样！<p>等一下！计算机如何知道何时呈现保加利亚式字形，何时使用俄语字形？<p>简短的回答：它不知道。不幸的是，Unicode 不是一个完美的系统，它有很多缺点。其中之一就是是将相同的码位分配给应该看起来不同的字形，比如西里尔小写字母 <span>K</span> 和保加利亚语小写字母 <span>K</span>（都是 <code>U+043A</code>）。<p>据我所知，亚洲人<a href=https://en.wikipedia.org/wiki/Han_unification>遭受的打击更大</a>：许多中文、日文和韩文的象形文字被分配了相同的码位：<figure><img src=assets/1718934063-034b59670af2ccbd4ef3765e633c6277.svg><figcaption>不同区域设置下的 U+8FD4</figcaption></figure><p>Unicode 这么做是出于节省码位空间的动机（我猜的）。渲染信息应该在字符串之外传递，作为区域设置（locale）/语言的元数据。<p>不幸的是，它未能实现 Unicode 最初的目标：<blockquote><p>[…] 不需要转义序列或控制码来指定任何语言中的任何字符。</blockquote><p>在实际中，对区域设置的依赖带来了很多问题：<ol><li>作为元数据，区域设置经常丢失。<li>人们不限于单一的区域设置。例如，我可以阅读和写作英语（美国）、英语（英国）、德语和俄语。我应该将我的计算机设置为哪个区域？<li>混起来后再匹配很难。比如保加利亚文中的俄语名字，反之亦然。这种情况不是时有发生吗？这是互联网，来自各种文化的人都在这里冲浪。<li>没有地方指定区域设置。即使是制作上面的两个截图也是比较复杂的，因为在大多数软件中，没有下拉菜单或文本输入来更改区域设置。<li>在需要的时候，我们只能靠猜。例如，Twitter 试图从推文本身的文本中猜测区域设置（因为它还能从哪里得到呢？）时有时会猜错<sup><a href=#user-content-fn-twitter>3</a></sup>：</ol><a href=https://twitter.com/nikitonsky/status/1171115067112398849><figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/443db722.jfif width=600></figure></a><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/d5d4c049.webp><h2>为什么 <code>String::toLowerCase()</code> 的参数中有个区域设置？</h2><p>Unicode 处理土耳其语中无点 <code>i</code> 的方式是说明其对区域设置依赖的另一个例子。<p>不同于英国人，土耳其人有两种 <code>I</code> 变体：有点的和无点的。Unicode 决定重用 ASCII 中的 <code>I</code> 和 <code>i</code>，并只添加两个新的码位：<code>İ</code> 和 <code>ı</code>。<p>不幸的是，这使得 <code>toLowerCase</code>/<code>toUpperCase</code> 在相同的输入上表现不同：<pre class=astro-code><code>var en_US = Locale.of(&#34;en&#34;, &#34;US&#34;);
var tr = Locale.of(&#34;tr&#34;);

&#34;I&#34;.toLowerCase(en_US); // =&gt; &#34;i&#34;
&#34;I&#34;.toLowerCase(tr); // =&gt; &#34;ı&#34;

&#34;i&#34;.toUpperCase(en_US); // =&gt; &#34;I&#34;
&#34;i&#34;.toUpperCase(tr); // =&gt; &#34;İ&#34;&#39;</code></pre><p>所以，不，你不能在不知道字符串是用什么语言编写的情况下将字符串转换为小写。<h2>我住在美国/英国，也应该在意这件事吗？</h2><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/c4da0528.png width=600 height=67><p>依然应该。即使是纯英文文本也使用了许多 ASCII 中没有的「排版符号」，比如：<ul><li>引号 <code>“</code> <code>”</code> <code>‘</code> <code>’</code>，<li>撇号 <code>’</code>，<li>连接号 <code>–</code> <code>—</code>，<li>空格的变体（长空格、短空格、不换行空格），<li>点 <code>•</code> <code>■</code> <code>☞</code>，<li>除了 <code>$</code> 之外的货币符号（这有点告诉你是谁发明了计算机，不是吗？）：<code>€</code> <code>¢</code> <code>£</code>，<li>数学符号——加号 <code>+</code> 和等号 <code>=</code> 是 ASCII 的一部分，但减号 <code>−</code> 和乘号 <code>×</code> 不是 <nobr>¯_(ツ)_/¯</nobr>，<li>各种其他符号 <code>©</code> <code>™</code> <code>¶</code> <code>†</code> <code>§</code>。</ul><p>见鬼，不用 Unicode，你甚至拼写不了 <code>café</code>、<code>piñata</code>
或 <code>naïve</code>。所以是的，我们同舟共济，即使是美国人。<p>法国人：你书的队。<sup><a href=#user-content-fn-touche>4</a></sup><h2>什么是代理对？</h2><p>这要追溯到 Unicode v1。Unicode 的第一个版本应该是固定宽度的。准确地说，是 16 位固定宽度：<figure><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/259ea8a4.png width=840 height=558><figcaption>Unicode 标准的 1.0 版本, 1991 年 10 月</figcaption></figure><p>他们相信 65,536 个字符足以涵盖所有人类语言。他们几乎是对的！<p>当他们意识到他们需要更多的码位时，UCS-2（没有代理对的 UTF-16 的原始版本）已经在许多系统中使用了。16 位，固定宽度，只给你 65,536 个字符。你能做什么呢？<p>Unicode 决定将这 65,536 个字符中的一些分配给编码更高码位的字符，从而将固定宽度的 UCS-2 转换为可变宽度的 UTF-16。<p><dfn>代理对</dfn>（<span>surrogate pair</span>）是用于编码单个 Unicode 码位的两个 UTF-16 单位。例如，<code>D83D DCA9</code>（两个 16 位单位）编码了一个码位，<code>U+1F4A9</code>。<p>代理对中的前 6 位用于掩码，剩下 2×10 个空闲位：<pre><p>High Surrogate          Low Surrogate
D800        ++          DC00
1101 10?? ???? ???? ++ 1101 11?? ???? ????</pre><p>从技术上讲，代理对的两半也可以看作是 Unicode 码位。实际上，从 <code>U+D800</code> 到 <code>U+DFFF</code> 的整个范围都被分配为「仅用于代理对」。从那里开始的码位甚至在任何其他编码中都不被认为是有效的。<figure><svg height="500" width="850"> <title>Roadmap to the Unicode BMP</title> <desc>This chart is a roadmap of character allocation for Unicode plane 0: Basic Multilingual Plane (BMP).  It was created on 2023-10-15 using Unicode 15.1 data.  Characters are categorized more-or-less by the chapters in The Unicode Standard.</desc> <defs> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> <linearGradient> <stop></stop> <stop></stop> <stop></stop> <stop></stop> </linearGradient> </defs> <rect height="500" width="850"></rect> <g> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect> <rect height="31.125" width="31.125"></rect></g> <g> <text>00</text> <text>01</text> <text>02</text> <text>03</text> <text>04</text> <text>05</text> <text>06</text> <text>07</text> <text>08</text> <text>09</text> <text>0A</text> <text>0B</text> <text>0C</text> <text>0D</text> <text>0E</text> <text>0F</text> <text>10</text> <text>11</text> <text>12</text> <text>13</text> <text>14</text> <text>15</text> <text>16</text> <text>17</text> <text>18</text> <text>19</text> <text>1A</text> <text>1B</text> <text>1C</text> <text>1D</text> <text>1E</text> <text>1F</text> <text>20</text> <text>21</text> <text>22</text> <text>23</text> <text>24</text> <text>25</text> <text>26</text> <text>27</text> <text>28</text> <text>29</text> <text>2A</text> <text>2B</text> <text>2C</text> <text>2D</text> <text>2E</text> <text>2F</text> <text>30</text> <text>31</text> <text>32</text> <text>33</text> <text>34</text> <text>35</text> <text>36</text> <text>37</text> <text>38</text> <text>39</text> <text>3A</text> <text>3B</text> <text>3C</text> <text>3D</text> <text>3E</text> <text>3F</text> <text>40</text> <text>41</text> <text>42</text> <text>43</text> <text>44</text> <text>45</text> <text>46</text> <text>47</text> <text>48</text> <text>49</text> <text>4A</text> <text>4B</text> <text>4C</text> <text>4D</text> <text>4E</text> <text>4F</text> <text>50</text> <text>51</text> <text>52</text> <text>53</text> <text>54</text> <text>55</text> <text>56</text> <text>57</text> <text>58</text> <text>59</text> <text>5A</text> <text>5B</text> <text>5C</text> <text>5D</text> <text>5E</text> <text>5F</text> <text>60</text> <text>61</text> <text>62</text> <text>63</text> <text>64</text> <text>65</text> <text>66</text> <text>67</text> <text>68</text> <text>69</text> <text>6A</text> <text>6B</text> <text>6C</text> <text>6D</text> <text>6E</text> <text>6F</text> <text>70</text> <text>71</text> <text>72</text> <text>73</text> <text>74</text> <text>75</text> <text>76</text> <text>77</text> <text>78</text> <text>79</text> <text>7A</text> <text>7B</text> <text>7C</text> <text>7D</text> <text>7E</text> <text>7F</text> <text>80</text> <text>81</text> <text>82</text> <text>83</text> <text>84</text> <text>85</text> <text>86</text> <text>87</text> <text>88</text> <text>89</text> <text>8A</text> <text>8B</text> <text>8C</text> <text>8D</text> <text>8E</text> <text>8F</text> <text>90</text> <text>91</text> <text>92</text> <text>93</text> <text>94</text> <text>95</text> <text>96</text> <text>97</text> <text>98</text> <text>99</text> <text>9A</text> <text>9B</text> <text>9C</text> <text>9D</text> <text>9E</text> <text>9F</text> <text>A0</text> <text>A1</text> <text>A2</text> <text>A3</text> <text>A4</text> <text>A5</text> <text>A6</text> <text>A7</text> <text>A8</text> <text>A9</text> <text>AA</text> <text>AB</text> <text>AC</text> <text>AD</text> <text>AE</text> <text>AF</text> <text>B0</text> <text>B1</text> <text>B2</text> <text>B3</text> <text>B4</text> <text>B5</text> <text>B6</text> <text>B7</text> <text>B8</text> <text>B9</text> <text>BA</text> <text>BB</text> <text>BC</text> <text>BD</text> <text>BE</text> <text>BF</text> <text>C0</text> <text>C1</text> <text>C2</text> <text>C3</text> <text>C4</text> <text>C5</text> <text>C6</text> <text>C7</text> <text>C8</text> <text>C9</text> <text>CA</text> <text>CB</text> <text>CC</text> <text>CD</text> <text>CE</text> <text>CF</text> <text>D0</text> <text>D1</text> <text>D2</text> <text>D3</text> <text>D4</text> <text>D5</text> <text>D6</text> <text>D7</text> <text>D8</text> <text>D9</text> <text>DA</text> <text>DB</text> <text>DC</text> <text>DD</text> <text>DE</text> <text>DF</text> <text>E0</text> <text>E1</text> <text>E2</text> <text>E3</text> <text>E4</text> <text>E5</text> <text>E6</text> <text>E7</text> <text>E8</text> <text>E9</text> <text>EA</text> <text>EB</text> <text>EC</text> <text>ED</text> <text>EE</text> <text>EF</text> <text>F0</text> <text>F1</text> <text>F2</text> <text>F3</text> <text>F4</text> <text>F5</text> <text>F6</text> <text>F7</text> <text>F8</text> <text>F9</text> <text>FA</text> <text>FB</text> <text>FC</text> <text>FD</text> <text>FE</text> <text>FF</text> </g> <g> <switch> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> <rect height="15.6" width="25"></rect> </g> <g> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> <rect height="14.3" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g> <g> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> <rect height="13" width="25"></rect> </g></switch> </g> <g> <switch> <g> <text>拉丁文字</text> <text>非拉丁欧洲文字</text> <text>非洲文字</text> <text>中东及西南亚文字</text> <text>南亚及中亚文字</text> <text>东南亚文字</text> <text>东亚文字</text> <text>中日韩汉字</text> <text>印度尼西亚及大洋洲文字</text> <text>美洲文字</text> <text>符号系统</text> <text>符号</text> <text>私人使用区</text> <text>UTF-16 代理区</text> <text>目前版本为 Unicode 15.1</text> </g> <g> <text>拉丁文字</text> <text>非拉丁歐洲文字</text> <text>非洲文字</text> <text>中東及西南亞文字</text> <text>南亞及中亞文字</text> <text>東南亞文字</text> <text>東亞文字</text> <text>中日韓漢字</text> <text>印度尼西亞及大洋洲文字</text> <text>美洲文字</text> <text>符號系統</text> <text>符號</text> <text>私人使用區</text> <text>UTF-16 代理區</text> <text>目前版本為 Unicode 15.1</text> </g> </switch> </g> <g><path></path></g> </svg><figcaption>这个在已经非常拥挤的基本多语言平面上的空间永远不会再被拿来干任何好事</figcaption></figure><h2>UTF-16 还活着吗？</h2><p>是的！<p>一个定长的、涵盖所有人类语言的编码的许诺是如此令人信服，以至于许多系统都迫不及待地采用了它。例如，Microsoft Windows、Objective-C、Java、JavaScript、.NET、Python 2、QT、短信，还有 CD-ROM！<p>自从那时以来，Python 已经进步了，CD-ROM 已经过时了，但其余的仍然停留在 UTF-16 甚至 UCS-2。因此，UTF-16 作为内存表示而存在。<p>在今天的实际情况下，UTF-16 的可用性与 UTF-8 大致相同。它也是变长的；计算 UTF-16 单元与计算字节或码位一样没有用，字位簇仍然很痛苦，等等。唯一的区别是内存需求。<p>UTF-16 的唯一缺点是其他所有东西都是 UTF-8，因此每次从网络或磁盘读取字符串时都要转换一下。<p>还有一个有趣的事实：Unicode 的平面数（17）是由 UTF-16 中代理对可以表达的内容决定的。<h2>结论</h2><p>让我们总结一下：<ul><li>Unicode 已经赢了。<li>UTF-8 是传输和储存数据时使用最广泛的编码。<li>UTF-16 仍然有时被用作内存表示。<li>字符串的两个最重要的视图是字节（分配内存/复制/编码/解码）和扩展字位簇（所有语义操作）。<li>以码位为单位来迭代字符串是错误的。它们不是书写的基本单位。一个字位可能由多个码位组成。<li>要检测字位的边界，你需要表格。<li>对于所有 Unicode 相关的东西，甚至是像 <code>strlen</code>、<code>indexOf</code> 和 <code>substring</code> 这样的无聊的东西，都要使用 Unicode 库。<li>Unicode 每年更新一次，规则有时会改变。<li>Unicode 字符串在比较之前需要进行归一化。<li>Unicode 在某些操作和渲染中依赖于区域设置。<li>即使是纯英文文本，这些都很重要。</ul><p>总的来说，是的，Unicode 不完美，但<ol><li>有一个能覆盖所有可能语言的编码、<li>全世界都同意使用它、<li>我们可以完全忘记编码和转换之类的东西</ol><p>的事实是一个奇迹。把这篇文章发送给你的程序员群友们，让他们也能了解它。<p><span>的确有这样一种东西叫做纯文本，<br>并且它使用 UTF-8 进行编码。</span><p>感谢 Lev Walkin 和我的赞助者们阅读了本文的早期草稿。<div><p>2023 年 10 月 2 日
· 在 <a href="https://news.ycombinator.com/item?id=37735801">HackerNews</a> 上讨论
· 翻译于 <time>2023 年 10 月 27 日</time>
· 在 <a href=https://twitter.com/lazy_static/status/1718672213585301620>Twitter</a> 上讨论（中文）·
最后更新于 <time>11 月 24 日</time></div><br><br><h3>译者注</h3><section><ol><li><p>这篇 2003 年的文章的中文翻译：<a href=https://xandersu.com/posts/%E8%AF%91-%E6%AF%8F%E4%B8%AA%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E9%83%BD%E5%BF%85%E9%A1%BB%E7%9F%A5%E9%81%93%E7%9A%84Unicode%E5%92%8C%E5%AD%97%E7%AC%A6%E9%9B%86%E7%9A%84%E7%BB%9D%E5%AF%B9%E6%9C%80%E4%BD%8E%E8%A6%81%E6%B1%82-%E4%B8%8D%E8%83%BD%E6%9C%89%E4%BB%BB%E4%BD%95%E5%80%9F%E5%8F%A3/>每一个软件开发者都必须了解的关于 Unicode 和字符集的基本知识（没有任何借口！）</a>。 <a href=#user-content-fnref-2003>↩</a><li><p><a href=https://zh.wikipedia.org/wiki/%E5%AD%97%E4%BD%8D><dfn>字位</dfn></a>又称形素、字素，是最小的有意义书写符号单位；此术语是由语音学里的「音位（音素）」类推到文字学的。 <a href=#user-content-fnref-1>↩</a><li><p>Twitter 错误渲染俄语为保加利亚语——注意 <span>и</span>、<span>й</span>、<span>ь</span>、<span>к</span>、<span>з</span> 等字母的字形。 <a href=#user-content-fnref-twitter>↩</a><li><p>原文是法语 <span><q>Touché</q></span>，意为「说得好」、「一针见血」。 <a href=#user-content-fnref-touche>↩</a></ol></section></article></main>
<hr>
<footer>
        <label>原网址: <a href="https://blog.xinshijiededa.men/unicode/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">访问</a></label><br/>
        <label>创建时间: 2024-06-21 09:41:03</label><br/>
        <br/>
        
      </footer>
</body>
</html>