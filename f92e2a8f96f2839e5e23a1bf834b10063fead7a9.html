<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow-DOM</title>
    <link rel="stylesheet" href="https://c1312.netlify.app/typo.css">
    <link rel="stylesheet" href="https://c1312.netlify.app/style.css">
</head>
<body>
<header>
  <h1>Shadow-DOM</h1>
</header>
<main class="typo"><div><p><br>Shadow DOM æ˜¯å››å¤§ç½‘ç»œç»„ä»¶æ ‡å‡†ä¹‹ä¸€ï¼Œæä¾› CSS ä½œç”¨åŸŸã€DOM å°è£…å’Œç»„åˆ(Composition) ç­‰ä¼˜åŠ¿ï¼Œæ„å»ºè‡ªå®šä¹‰å…ƒç´ ã€‚</p><a></a><h2><a href=#%E4%BB%80%E4%B9%88%E6%98%AF-Shadow-DOM></a>ä»€ä¹ˆæ˜¯ Shadow DOM</h2><p>æµè§ˆå™¨åœ¨è§£æç½‘é¡µæ–‡æ¡£çš„æ—¶å€™ï¼Œä¼šå°† HTML æ ‡ç­¾è½¬æ¢æˆèŠ‚ç‚¹ï¼Œä¸ºäº†ä¿æŒé¡µé¢çš„å±‚æ¬¡ç»“æ„ï¼Œè¿™äº›èŠ‚ç‚¹æ„æˆä¸€ä¸ªèŠ‚ç‚¹æ ‘ï¼Œè¿™ä¸ªç»“æ„å°±æ˜¯ DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ã€‚DOM å°†æ–‡æ¡£ä½œä¸ºä¸€ä¸ªç»“æ„åŒ–çš„èŠ‚ç‚¹ç»„ä»¥åŠåŒ…å«å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ï¼Œæ˜¯ HTML çš„ç¼–ç¨‹æ¥å£ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ JavaScript æ¥è®¿é—®æ“çºµ DOMã€‚<br><pre><code class="highlight dart">const header = document.createElement(&#39;header&#39;);const h1 = document.createElement(&#39;h1&#39;);h1.textContent = &#39;Hello world!&#39;;header.appendChild(h1);document.body.appendChild(header);</code></pre><p><p>è¿™æ®µ JavaScript ä»£ç æ‰§è¡Œåä¼šç”Ÿæˆå¦‚ä¸‹çš„ DOM ç»“æ„ï¼š<br><pre><code class="highlight xml">  <header>    <h1>Hello DOM</h1>  </header></code></pre><p><p>é‚£ä»€ä¹ˆæ˜¯ Shadow DOM å‘¢â“<br>Shadow DOM ä¸º Web ç»„ä»¶ä¸­çš„ DOM å’Œ CSS æä¾›äº†å°è£…ã€‚Shadow DOM ä½¿å¾—è¿™äº›ä¸œè¥¿ä¸ä¸»æ–‡æ¡£çš„ DOM ä¿æŒåˆ†ç¦»ã€‚Shadow DOM ä¸æ™®é€šçš„ DOM çš„åŒºåˆ«æ˜¯ï¼š<br>ğŸ‘‰ é€šå¸¸åˆ›å»ºæ–°çš„ DOM èŠ‚ç‚¹é™„åŠ åˆ°å…¶ä»– DOM å…ƒç´ ä¸Šï¼Œå°±ä¼šæˆä¸ºå…¶å­èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ï¼›ä½†å€ŸåŠ© Shadow DOMï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª DOM æ ‘é™„åŠ åˆ°å…¶ä»–å…ƒç´ ä¸Šï¼Œè¿™ä¸ª DOM æ ‘å¹¶éå…¶å­èŠ‚ç‚¹ï¼ˆå…ƒç´ ï¼‰ï¼Œå…¶æ‹¥æœ‰è‡ªèº«çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œè¿™ä¸ª DOM æ ‘ç§°ä¸ºï¼š<strong><code>shadwo tree</code></strong>ã€‚è¢«é™„åŠ çš„å…ƒç´ ç§°ä¸º <strong><code>shadow host</code></strong>ï¼Œè¿™ä¸ª DOM æ ‘ç§°ä¸º <strong><code>shadow root</code></strong>ã€‚<blockquote><p>You can think of shadow DOM as a scoped subtree inside your element.</blockquote><pre><code class="highlight dart">const header = document.createElement(&#39;header&#39;);const shadowRoot = header.attachShadow({mode: &#39;open&#39;});shadowRoot.innerHTML = &#39;<h1>Hello Shadow DOM</h1>&#39;; // Could also use appendChild().// header.shadowRoot === shadowRoot// shadowRoot.host === header</code></pre><ul><li>ä¸ºå…ƒç´ åˆ›å»º shadow DOMï¼Œè°ƒç”¨ <code>element.attachShadow()</code><li>é€šè¿‡ <code>shadowRoot</code> å±æ€§è·å–å…ƒç´ é™„åŠ çš„ Shadow DOM<li>é€šè¿‡ shadow root çš„ <code>host</code> å±æ€§è·å–å…¶é™„å±çš„å…ƒç´ </ul><p>â—ï¸<strong>æ³¨æ„ï¼š</strong>å¹¶éæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥è°ƒç”¨ <code>element.attachShadow()</code> ä¸ºå…¶åˆ›å»ºæ·»åŠ  Shadow DOMï¼Œå› ä¸ºæœ‰äº›å…ƒç´ æµè§ˆå™¨å·²ç»ä¸ºå…¶æ·»åŠ äº† Shadow DOMï¼Œä¾‹å¦‚ <code>&lt;textarea&gt;</code> <code>&lt;input&gt;</code>ï¼›è€Œè¿˜æœ‰äº›å…ƒç´ ä¸ºå…¶æ·»åŠ  Shadow DOM æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¾‹å¦‚ <code>&lt;img&gt;</code>ã€‚<pre><code class="highlight less">document.createElement(&#39;input&#39;).attachShadow({mode: &#39;open&#39;});// Error. `<input>` cannot host shadow dom.</code></pre><p>åœ¨åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ æ—¶ï¼ŒShadow DOM å°¤å…¶æœ‰ç”¨ã€‚ä½¿ç”¨ Shadow DOM æ¥åˆ†éš”å…ƒç´ çš„ HTMLã€CSS å’Œ JSï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªç»„ä»¶ã€‚<br><pre><code class="highlight scala">window.customElements.define(&#39;x-tag&#39;, class extends HTMLElement {  constructor() {    super()    let shadowRoot = this.attachShadow({mode: &#39;open&#39;})    shadowRoot.innerHTML = `    <style>    b {      color: red;    }    </style>    <b>Hello world</b>    `  }})</code></pre><p><p>æ³¨æ„ Shadow DOM ä¸­çš„ CSS è§„åˆ™çš„ä½œç”¨åŸŸä»…é™äº <code>&lt;x-tag&gt;</code>ã€‚<h2><a href=#%E7%BB%84%E5%90%88%E5%92%8C-slot></a>ç»„åˆå’Œ slot</h2><p>ç»„åˆæ˜¯ shadow DOM æœ€éš¾ç†è§£çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½†å¯ä»¥è¯´æ˜¯æœ€é‡è¦çš„åŠŸèƒ½ã€‚<h3><a href=#light-DOM-%E5%92%8C-shadow-DOM></a>light DOM å’Œ shadow DOM</h3><p><strong>light DOM</strong><br>ä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·ç¼–å†™çš„æ ‡è®°ï¼ŒDOM å…ƒç´ çš„å®é™…å­å…ƒç´ ï¼Œè¯¥å­å…ƒç´ ä¸åœ¨ç»„ä»¶çš„ shadow DOM ä¹‹å†…ï¼Œè¿™å°±æ˜¯ light DOMã€‚<br><pre><code class="highlight xml"><button>    <img src=gear.svg>  <span>Settings</span></button></code></pre><p><p>å…¶ä¸­ <code>image</code> å’Œ <code>span</code> å³æ˜¯ <code>button</code> çš„ light DOMã€‚<p><strong>shadow DOM</strong><br>ç»„ä»¶ä½œè€…ç¼–å†™çš„æ ‡è®°ï¼Œå®ƒå®šä¹‰ç»„ä»¶çš„å†…éƒ¨ç»“æ„ï¼Œä½œç”¨åŸŸ CSS ç­‰<br><pre><code class="highlight xml">#shadow-root  <style>...</style>  <slot></slot>  <span>    <slot>Button</slot>  </span></code></pre><p><p><strong>Flattened DOM tree</strong><br>æµè§ˆå™¨å°†ç”¨æˆ·çš„ light DOM åˆ†å¸ƒåˆ° shadow DOM ä¸­ï¼Œæ¸²æŸ“æˆä¸€é¢— DOM æ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong><code>flattening the tree</code></strong>ï¼Œè¿™æ£µæ ‘ç§°ä¸ºæ‰å¹³æ ‘ <strong><code>Flattened DOM tree</code></strong>ã€‚ æ‰å¹³æ ‘ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ DevTools ä¸­æœ€ç»ˆçœ‹åˆ°çš„æ ‘ä»¥åŠåœ¨é¡µé¢ä¸Šæ¸²æŸ“çš„ç»“æœã€‚<br><a href=https://raw.githubusercontent.com/yingshandeng/image-host/master/data/FF183E44-E19D-4B24-918B-2DE5067699A4.png><img src=https://note-2019-images.oss-cn-hangzhou.aliyuncs.com/de06ec6a.jfif></a><h3><a href=#%E5%85%83%E7%B4%A0></a><slot>å…ƒç´ </slot></h3><p>Shadow DOM ä½¿ç”¨ <code>&lt;slot&gt;</code> å…ƒç´ å°† light DOM æ ‘ç»„åˆåˆ° shadow DOM ä¸­ï¼Œå½¢æˆä¸€é¢— DOM æ ‘ã€‚<p>Slot ç›¸å½“äºæ˜¯ç»„ä»¶å†…éƒ¨çš„å ä½ç¬¦ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª <code>&lt;slot&gt;</code>ï¼Œå¯ä»¥å°†å¤–éƒ¨çš„æ ‡è®°å¼•å…¥åˆ°ç»„ä»¶ shadow DOM ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œç›¸å½“äºâ€œè·¨åŸŸâ€äº† shadow DOM çš„è¾¹ç•Œï¼Œè¿™äº›å¼•å…¥åˆ° shadow DOM ä¸­çš„å…ƒç´ è¢«ç§°ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹ <strong><code>distributed nodes</code></strong>ã€‚æ³¨æ„ï¼šslot å®é™…ä¸Šå¹¶ä¸ç§»åŠ¨è¿™äº›åˆ†å¸ƒå¼èŠ‚ç‚¹ï¼Œå®ƒä»¬åœ¨ shadow DOM å†…éƒ¨çš„å…¶ä»–ä½ç½®è¿›è¡Œæ¸²æŸ“ã€‚<p>ç»„ä»¶å¯åœ¨å…¶ shadow DOM ä¸­å®šä¹‰é›¶ä¸ªæˆ–å¤šä¸ª slotã€‚Slot å¯ä»¥ä¸ºç©ºï¼Œæˆ–è€…æä¾›å›é€€å†…å®¹(fallback content)ï¼Œå¦‚æœç”¨æˆ·ä¸æä¾› light DOM å†…å®¹ï¼Œslot ä¼šå°†å¯¹å…¶å¤‡ç”¨å†…å®¹è¿›è¡Œæ¸²æŸ“ã€‚<pre><code class="highlight xml"><slot></slot><slot>Fancy button</slot> </code></pre><p>è¿˜å¯ä»¥åˆ›å»ºå‘½å slot (named slots)ï¼Œä½¿ç”¨ç»„ä»¶çš„ç”¨æˆ·é€šè¿‡åç§°æ‰¾åˆ°ç‰¹å®šçš„ slotã€‚<br><pre><code class="highlight xml"><x-tag>  <p>Custom Elements</x-tag>#shadow-root  <style>  b {    color: red;  }  </style>  <b>Hello world</b>  <slot></slot></code></pre><p><h2><a href=#%E8%AE%BE%E5%AE%9A%E6%A0%B7%E5%BC%8F></a>è®¾å®šæ ·å¼</h2><p>shadow DOM æœ€æœ‰ç”¨çš„åŠŸèƒ½æ˜¯ä½œç”¨åŸŸ CSSï¼š<ul><li>å¤–éƒ¨é¡µé¢ä¸­çš„ CSS é€‰æ‹©å™¨ä¸ä¼šåº”ç”¨äºç»„ä»¶å†…éƒ¨ã€‚<li>ç»„ä»¶å†…éƒ¨å®šä¹‰çš„æ ·å¼ä¹Ÿä¸ä¼šæ¸—å‡ºï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸä»…é™äºå®¿ä¸»å…ƒç´ (shadow host)</ul><h3><a href=#%E9%80%9A%E8%BF%87%E9%80%89%E6%8B%A9%E5%99%A8%E8%AE%BE%E5%AE%9A%E6%A0%B7%E5%BC%8F></a>é€šè¿‡é€‰æ‹©å™¨è®¾å®šæ ·å¼</h3><p><strong>ä½¿ç”¨ <code>:host</code> ä¸ºç»„ä»¶ä¸ºè‡ªèº«è®¾å®šæ ·å¼</strong><br>éœ€è¦æ³¨æ„ï¼šå¤–éƒ¨é¡µé¢ä¸­ä¸ºç»„ä»¶è®¾å®šçš„æ ·å¼æ¯” <code>:host</code> è§„åˆ™å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºç»„ä»¶è‡ªèº«ï¼Œå¤–éƒ¨æ ·å¼ä¼˜å…ˆï¼Œç”¨æˆ·å¯ä»¥åœ¨å¤–éƒ¨è®¾ç½®ç»„ä»¶è‡ªèº«çš„æ ·å¼ã€‚<br><pre><code class="highlight xml">// å¤–éƒ¨æ ·å¼æ¯” :host ä¼˜å…ˆx-tag {  border: 1px solid red;}#shadow-root  <style>  :host {    border: 1px solid green;  }  </style></code></pre><p><p><strong>ä½¿ç”¨ <code>:host(&lt;selector&gt;)</code> åŒ¹é…ç»„ä»¶è‡ªèº«ä¸åŒçŠ¶æ€</strong><br>é€šè¿‡ <code>:host(&lt;selector&gt;)</code> åŒ¹é…ä¸åŒçŠ¶æ€ï¼Œå¯¹ç»„ä»¶è‡ªèº«æˆ–è€…å†…éƒ¨èŠ‚ç‚¹è®¾å®šä¸åŒçš„æ ·å¼<br><pre><code class="highlight xml">#shadow-root  <style>  :host(:hover) {  }  :host(.red_bg) {  }  :host(.green_bg) {  }  :host(.disable) button {  }  </style></code></pre><p><p><strong>ä½¿ç”¨ <code>:host-context(&lt;selector&gt;)</code> åŒ¹é…ä»»æ„çˆ¶çº§</strong><br>ä½¿ç”¨ <code>:host-context(&lt;selector&gt;)</code> ä¸»è¦ç”¨äºæ ¹æ®ç»„ä»¶æ‰€åœ¨çš„ç¯å¢ƒè¿›è¡Œä¸»é¢˜åŒ–ï¼ˆåŸºäºæƒ…å¢ƒè®¾å®šæ ·å¼ï¼‰ï¼Œä¾‹å¦‚è®¾ç½®ç™½å¤©æ¨¡å¼ï¼Œå¤œæ™šæ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨ <code>&lt;html&gt;</code> æˆ–è€… <code>&lt;body&gt;</code> è®¾å®šä¸åŒçš„ classï¼Œè€Œç»„ä»¶é€šè¿‡ <code>:host-context(&lt;selector&gt;)</code> å°±å¯ä»¥åŒ¹é…åˆ°<pre><code class="highlight dts">  <fancy-tabs>    ...  </fancy-tabs>#shadow-root  :host-context(.darktheme) {    color: white;    background: black;  }</code></pre><p><strong>ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> åŒ¹é…åˆ†å¸ƒåˆ° <slot>ä¸­çš„èŠ‚ç‚¹</slot></strong><br>ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹è®¾å®šæ ·å¼<br><pre><code class="highlight xml"><name-badge>  #shadow-root    <h2>Eric Bidelman</h2>    <span>      Digital Jedi, <span>Google</span>    </span></name-badge></code></pre><p><p>ç»„ä»¶çš„ shadow DOM å¯ä¸ºç”¨æˆ·çš„ <code>&lt;h2&gt;</code> å’Œ <code>.title</code> è®¾å®šæ ·å¼ï¼š<br><pre><code class="highlight xml"><style>  ::slotted(h2) {    margin: 0;    font-weight: 300;    color: red;  }  ::slotted(.title) {     color: orange;  }  /* DOESN'T WORK (can only select top-level nodes).  ::slotted(.company),  ::slotted(.title .company) {    text-transform: uppercase;  }  */</style></code></pre><p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>â‘  ä½¿ç”¨ <code>::slotted(&lt;compound-selector&gt;)</code> åªèƒ½ä¸ºåˆ†å¸ƒèŠ‚ç‚¹çš„<strong>é¡¶çº§èŠ‚ç‚¹</strong>è®¾ç½®æ ·å¼ã€‚<br>â‘¡ slot å¹¶ä¸ä¼šç§»åŠ¨ light DOMï¼Œlight DOM èŠ‚ç‚¹åˆ†å¸ƒåˆ° shadow DOM ä¸­åï¼Œslot ä¼šå¯¹å…¶ DOM è¿›è¡Œæ¸²æŸ“ï¼Œæ ·å¼è®¾ç½®ï¼Œä½†æ˜¯èŠ‚ç‚¹å®é™…è¿˜æ˜¯ç•™åœ¨åŸå¤„ã€‚å¦‚æœå¤–éƒ¨å¯¹ light DOM è®¾ç½®äº†æ ·å¼ï¼Œé‚£ä¹ˆå¤–éƒ¨æ ·å¼å°†ä¼šè¦†ç›– shadow DOM ä¸­é€šè¿‡ <code>::slotted(&lt;compound-selector&gt;)</code> è®¾ç½®çš„æ ·å¼ï¼Œå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§ã€‚<br><pre><code class="highlight xml"><style>  x-tag p {    color: red; // å¤–éƒ¨æ ·å¼ï¼Œå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§  }</style><x-tag>  <p>Custom Elements</x-tag>#shadow-root  <style>  ::slotted(p) {    color: green;  }  </style></code></pre><p><h3><a href=#%E4%BB%8E%E5%A4%96%E9%83%A8%E4%B8%BA%E7%BB%84%E4%BB%B6%E8%AE%BE%E5%AE%9A%E6%A0%B7%E5%BC%8F></a>ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼</h3><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»å¤–éƒ¨ä¸ºç»„ä»¶è®¾å®šæ ·å¼ï¼šæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ‡è®°åç§°ä½œä¸ºé€‰æ‹©å™¨<p><strong>ä¸ºç»„ä»¶è‡ªèº«è®¾å®šæ ·å¼</strong><br>ä»å¤–éƒ¨ä¸ºç»„ä»¶è‡ªèº«è®¾å®šæ ·å¼æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ç»„ä»¶æ ‡ç­¾åç§°ä½œä¸ºé€‰æ‹©å™¨ï¼Œè®¾ç½® CSS æ ·å¼ã€‚<br><pre><code class="highlight crmsh">x-tag {}x-tag:hover {}</code></pre><p><p>æ³¨æ„ï¼š<strong>å¤–éƒ¨æ ·å¼æ€»æ˜¯ä¼˜å…ˆäºåœ¨ shadow DOM ä¸­å®šä¹‰çš„æ ·å¼ã€‚</strong>ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·åœ¨ç»„ä»¶å¤–éƒ¨ç¼–å†™ï¼š<code>fancy-tabs { width: 500px; }</code>ï¼Œå®ƒå°†ä¼˜å…ˆäºç»„ä»¶çš„è§„åˆ™ï¼š<code>:host { width: 650px;}</code>ã€‚<p><strong>ä¸ºç»„ä»¶å†…éƒ¨å…ƒç´ è®¾å®šæ ·å¼</strong><br>åœ¨ç»„ä»¶å¤–éƒ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡é€‰æ‹©å™¨å¯¹ç»„ä»¶å†…çš„å…ƒç´ è®¾ç½®æ ·å¼ã€‚ç»„ä»¶æä¾›è‡ªå®šä¹‰å±æ€§ <strong>custom properties</strong>ï¼Œç›¸å½“äºæ˜¯æ ·å¼å ä½ç¬¦ï¼Œå¤–éƒ¨é€šè¿‡å¯¹è‡ªå®šä¹‰å±æ€§ <strong>custom properties</strong> æ¥è°ƒæ•´ç»„ä»¶å†…éƒ¨å…ƒç´ çš„æ ·å¼ã€‚<p>ä¾‹å¦‚ï¼Œ<code>&lt;fancy-tabs&gt;</code> å¯è®©ç”¨æˆ·æ›¿æ¢èƒŒæ™¯é¢œè‰²ï¼š<br><pre><code class="highlight xml"><style>  fancy-tabs {    margin-bottom: 32px;    --fancy-tabs-bg: black;  }</style><fancy-tabs>...</fancy-tabs></code></pre><p><p>åœ¨å…¶ shadow DOM å†…éƒ¨ï¼š<br><pre><code class="highlight css">:host([background]) {  background: var(--fancy-tabs-bg, #9E9E9E);  border-radius: 10px;  padding: 10px;}</code></pre><p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥ç»„ä»¶å°†ä½¿ç”¨ <code>black</code> ä½œä¸ºèƒŒæ™¯å€¼ï¼Œå› ä¸ºç”¨æˆ·æŒ‡å®šäº†è¯¥å€¼ã€‚ å¦åˆ™èƒŒæ™¯é¢œè‰²å°†é‡‡ç”¨é»˜è®¤å€¼ <code>#9E9E9E</code>ã€‚<h2><a href=#%E5%85%B6%E4%BB%96></a>å…¶ä»–</h2><h3><a href=#%E9%81%BF%E5%85%8D%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%88%9B%E5%BB%BA-closed-shadow-root></a>é¿å…åœ¨ç»„ä»¶ä¸­åˆ›å»º closed shadow root</h3><p>shadow DOM çš„å¦ä¸€æƒ…å†µç§°ä¸º<strong>é—­åˆ</strong>æ¨¡å¼ã€‚åˆ›å»ºclosed shadow DOM tree åï¼Œåœ¨å¤–éƒ¨æ— æ³•é€šè¿‡ JavaScript è®¿é—®ç»„ä»¶çš„å†…éƒ¨ DOMã€‚è¿™ä¸ <code>&lt;video&gt;</code> ç­‰åŸç”Ÿå…ƒç´ å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼ŒJavaScript æ— æ³•è®¿é—® <code>&lt;video&gt;</code> çš„ shadow DOMï¼Œå› ä¸ºæµè§ˆå™¨ä½¿ç”¨closed shadow rootæ¥å®ç°ã€‚<pre><code class="highlight dart">const div = document.createElement(&#39;div&#39;);const shadowRoot = div.attachShadow({mode: &#39;closed&#39;}); // close shadow tree// div.shadowRoot === null// shadowRoot.host === div</code></pre><h3><a href=#%E5%85%B3%E4%BA%8E-slot-%E7%9A%84-API></a>å…³äº slot çš„ API</h3><p><strong><code>slotchange</code> äº‹ä»¶</strong><p>å½“ slot çš„åˆ†å¸ƒå¼èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>slotchange</code> äº‹ä»¶ä¼šè§¦å‘ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ä» light DOM ä¸­æ·»åŠ /ç§»é™¤å­é¡¹æ—¶ã€‚<pre><code class="highlight typescript">const slot = this.shadowRoot.querySelector(&#39;#slot&#39;);slot.addEventListener(&#39;slotchange&#39;, e =&gt; {  console.log(&#39;light dom children changed!&#39;);});</code></pre><p>æ³¨ï¼šå½“ç»„ä»¶çš„å®ä¾‹é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼Œ<code>slotchange</code> ä¸è§¦å‘ã€‚<p><strong>æŸ¥çœ‹ slot ä¸­æ¸²æŸ“çš„å…ƒç´ </strong><br>è°ƒç”¨ <code>slot.assignedNodes()</code> å¯æŸ¥çœ‹ slot æ­£åœ¨æ¸²æŸ“å“ªäº›å…ƒç´ ï¼›è¯¥æ–¹æ³•ä¸­ä¼ å…¥ <code>{flatten: true}</code> é€‰é¡¹å°†è¿”å› slot çš„å¤‡ç”¨å†…å®¹fallbcak contentï¼ˆå‰ææ˜¯æ²¡æœ‰åˆ†å¸ƒä»»ä½•èŠ‚ç‚¹ï¼‰ã€‚<table><thead><tr><th>ç”¨æ³•<th>è°ƒç”¨<th>ç»“æœ<tbody><tr><td><code>&lt;button is=&#34;better-button&#34;&gt;My button&lt;/button&gt;</code><td>slot.assignedNodes();<td>[text]<tr><td><code>&lt;button is=&#34;better-button&#34;&gt;&lt;/button&gt;</code><td>slot.assignedNodes();<td>[]<tr><td><code>&lt;button is=&#34;better-button&#34;&gt;&lt;/button&gt;</code><td>slot.assignedNodes({flatten: true});<td>[<b>fallback content</b>]</table><p><strong>æŸ¥çœ‹å…ƒç´ æ¸²æŸ“åœ¨å“ªä¸ª slot ä¸­</strong><br><code>element.assignedSlot</code> å°†å‘Šè¯‰æ‚¨å…ƒç´ åˆ†é…åˆ°ç»„ä»¶çš„å“ªä¸ª slotã€‚<h3><a href=#Shadow-DOM-%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B></a>Shadow DOM äº‹ä»¶æ¨¡å‹</h3><p>å½“äº‹ä»¶ä» shadow DOM ä¸­è§¦å‘æ—¶ï¼Œå…¶ç›®æ ‡ target ä¸ºç»´æŒ shadow DOM çš„å°è£…ï¼Œä¸æš´éœ² shadow DOM ä¸­çš„å†…å®¹å…ƒç´ ï¼Œä¼šè¿›è¡Œé‡ç½® retargetï¼Œçœ‹èµ·æ¥äº‹ä»¶æ˜¯æ¥è‡ªç»„ä»¶æœ¬èº«ï¼Œè€Œä¸æ˜¯ç»„ä»¶ä¸­ shadow DOM ä¸­çš„å†…å®¹å…ƒç´ ã€‚<p>å¤§éƒ¨åˆ†äº‹ä»¶éƒ½ä¼šè·¨è¿‡ shadow DOM è¾¹ç•Œï¼Œå‘å¤–ä¼ æ’­ï¼š<ul><li>èšç„¦äº‹ä»¶ï¼šblurã€focusã€focusinã€focusout<li>é¼ æ ‡äº‹ä»¶ï¼šclickã€dblclickã€mousedownã€mouseenterã€mousemoveï¼Œç­‰ç­‰<li>æ»šè½®äº‹ä»¶ï¼šwheel<li>è¾“å…¥äº‹ä»¶ï¼šbeforeinputã€input<li>é”®ç›˜äº‹ä»¶ï¼škeydownã€keyup<li>ç»„åˆäº‹ä»¶ï¼šcompositionstartã€compositionupdateã€compositionend<li>æ‹–æ”¾äº‹ä»¶ï¼šdragstartã€dragã€dragendã€dropï¼Œç­‰ç­‰</ul><p>å¯¹äº <code>mode</code> ä¸º <code>open</code> çš„ shadow DOMï¼Œäº‹ä»¶å›è°ƒä¸­ï¼Œè°ƒç”¨ <code>event.composedPath()</code> å°†è¿”å›äº‹ä»¶å‘ä¸Šä¼ æ’­ç»è¿‡çš„èŠ‚ç‚¹è·¯å¾„ã€‚<p>å¯¹äºç»„ä»¶å†…çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œä¸ä¼šä¼ æ’­å‡º shadow DOMï¼Œé™¤éäº‹ä»¶åˆ›å»ºæ—¶æŒ‡å®š <code>composed: true</code><br><pre><code class="highlight dart">// Inside <fancy-tab> custom element class definition:selectTab() {  const tabs = this.shadowRoot.querySelector(&#39;#tabs&#39;);  tabs.dispatchEvent(new Event(&#39;tab-select&#39;, {bubbles: true, composed: true}));}</fancy-tab></code></pre><p><p>å¦‚æœ <code>composed: false</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œç”¨æˆ·æ— æ³•åœ¨ç»„ä»¶å¤–éƒ¨ä¾¦å¬åˆ°è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶ã€‚<br><pre><code class="highlight dust"><fancy-tabs></fancy-tabs><script>  const tabs = document.querySelector('fancy-tabs');  tabs.addEventListener('tab-select', e => {    // won't fire if `tab-select` wasn't created with `composed: true`.  });</script></code></pre><p><h2><a href=#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5></a>å‚è€ƒé“¾æ¥</h2><p>æœ¬æ–‡ä¸»è¦æ˜¯é˜…è¯» <strong>Shadow DOM v1: Self-Contained Web Components</strong> åï¼Œç†è§£æ•´ç†è€Œæ¥ã€‚<br>è‹±æ–‡åŸæ–‡ï¼š<a href=https://developers.google.com/web/fundamentals/web-components/shadowdom>Shadow DOM v1: Self-Contained Web Components</a><br>ä¸­æ–‡ç¿»è¯‘ï¼š<a href="https://developers.google.com/web/fundamentals/web-components/best-practices?hl=zh-cn">Shadow DOM v1ï¼šç‹¬ç«‹çš„ç½‘ç»œç»„ä»¶</a></div></main>
<hr>
<footer>
        <label>åŸç½‘å€: <a href="http://objcer.com/2017/10/20/Shadow-DOM/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">è®¿é—®</a></label><br/>
        <label>åˆ›å»ºæ—¶é—´: 2024-04-14 21:31:53</label><br/>
        <br/>
        
      </footer>
<link rel=stylesheet href=https://cp-bkt1.oss-cn-hangzhou.aliyuncs.com/cdn/prism.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-twilight.min.css>
<script src=https://cp-bkt1.oss-cn-hangzhou.aliyuncs.com/cdn/prism.js></script>
</body>
</html>